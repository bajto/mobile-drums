<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">
<title>Drum Pad ‚Äî PWA</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" sizes="512x512" href="icon-512.png">
<link rel="apple-touch-icon" href="icon-512.png">
<meta name="theme-color" content="#0b0d10">
<style>
:root{ --bg:#0b0d10; --pad:#1b1f24; --pad-active:#2d333b; --text:#e6edf3; --accent:#4aa3ff; --muted:#9aa4ad; }
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
.topbar{position:fixed;top:0;left:0;right:0;display:flex;gap:.5rem;align-items:center;padding:.6rem env(safe-area-inset-right,12px) .6rem env(safe-area-inset-left,12px);background:linear-gradient(180deg,rgba(0,0,0,.5),rgba(0,0,0,0));z-index:20}
.title{font-weight:800;letter-spacing:.4px;margin-right:auto}
.btn{appearance:none;border:1px solid #2b3138;background:var(--pad);color:var(--text);padding:.5rem .75rem;border-radius:.6rem;font-weight:700;cursor:pointer}
.btn:active{transform:scale(.98)}
.range{display:flex;align-items:center;gap:.45rem;font-size:.9rem}
.range input{width:110px}
.grid{position:fixed;inset:56px 0 calc(env(safe-area-inset-bottom,0) + 0px) 0;display:grid;gap:.8rem;padding:.8rem;grid-template-columns:repeat(3,1fr);grid-auto-rows:1fr}
@media(orientation:landscape){.grid{grid-template-columns:repeat(5,1fr);inset:50px 0 0 0}}
.pad{background:var(--pad);border:1px solid #2b3138;border-radius:1rem;display:flex;align-items:center;justify-content:center;text-align:center;padding:.45rem;user-select:none;-webkit-user-select:none;font-weight:800;letter-spacing:.3px;touch-action:none;box-shadow:0 2px 0 rgba(0,0,0,.5) inset,0 6px 18px rgba(0,0,0,.25)}
.pad small{display:block;opacity:.7;font-weight:600;margin-top:.25rem;font-size:.75rem}
.pad.active{background:var(--pad-active);outline:2px solid var(--accent);box-shadow:0 0 0 4px rgba(74,163,255,.15),0 10px 28px rgba(0,0,0,.4) inset;transform:scale(.99)}
.footer{position:fixed;left:0;right:0;bottom:0;padding:.5rem env(safe-area-inset-right,12px) calc(env(safe-area-inset-bottom,12px) + .5rem) env(safe-area-inset-left,12px);display:flex;justify-content:center;font-size:.8rem;opacity:.7;text-align:center}
#tapStart{position:fixed;inset:0;background:rgba(0,0,0,.86);color:var(--text);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1rem;padding:2rem;text-align:center}
#tapStart .big{font-size:1.25rem;font-weight:800}
#tapStart .hint{opacity:.8}
#panel{position:fixed;right:.8rem;top:3.2rem;z-index:30;width:min(560px,92vw);max-height:70vh;overflow:auto;background:#0e1116;border:1px solid #2b3138;border-radius:1rem;padding:.8rem;display:none}
#panel h3{margin:.2rem 0 .6rem 0}
.list{display:grid;grid-template-columns:repeat(2,1fr);gap:.35rem .75rem}
.list label{display:flex;align-items:center;gap:.45rem;padding:.35rem .45rem;border-radius:.5rem;cursor:pointer}
.list label:hover{background:#161b22}
.actions{display:flex;gap:.5rem;justify-content:flex-end;margin-top:.6rem}
.badge{font-size:.75rem;color:var(--muted)}
kbd{background:#11151b;border:1px solid #2b3138;border-bottom-width:2px;border-radius:.35rem;padding:.05rem .4rem}
</style>
</head>
<body>
<div id="tapStart">
  <div class="big">Dotknij, aby rozpoczƒÖƒá</div>
  <button id="tapStartBtn" class="btn">Start audio</button>
  <div class="hint">iOS/Safari wymaga dotkniƒôcia ekranu, by w≈ÇƒÖczyƒá d≈∫wiƒôk</div>
</div>

<div class="topbar">
  <div class="title">ü•Å Drum Pad</div>
  <button id="kitBtn" class="btn" aria-expanded="false">Zestaw</button>
  <button id="startBtn" class="btn">Start audio</button>
  <div class="range">G≈Ço≈õno≈õƒá <input id="volume" type="range" min="0" max="1" step="0.01" value="0.9"></div>
</div>

<div id="panel">
  <h3>Wybierz instrumenty (maks. 12)</h3>
  <div class="badge">Zaznacz, co chcesz mieƒá na padach ‚Üí ‚ÄûZastosuj‚Äù.</div>
  <div class="list" id="kitList"></div>
  <div class="actions">
    <button id="applyBtn" class="btn">Zastosuj</button>
    <button id="closeBtn" class="btn">Zamknij</button>
  </div>
</div>

<div class="grid" id="grid"></div>

<div class="footer">Multi-touch. Na komputerze: <kbd>QWER</kbd>/<kbd>ASDF</kbd>/<kbd>ZXCV</kbd>. Na iPhonie u≈ºyj Safari ‚Üí ‚ÄûDo ekranu poczƒÖtkowego‚Äù dla offline.</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(()=>{}); });
}

(()=>{
let ctx=null, master=null, volumeNode=null, started=false;
const vol = document.getElementById('volume');
function initAudio(){
  if (ctx) return;
  const AC = window.AudioContext || window.webkitAudioContext;
  ctx = new AC({latencyHint:'interactive'});
  master = ctx.createGain();
  volumeNode = ctx.createGain();
  master.connect(volumeNode).connect(ctx.destination);
  volumeNode.gain.value = parseFloat(vol.value);
  const o = ctx.createOscillator(), g = ctx.createGain();
  g.gain.value = 0.0001; o.connect(g).connect(master); o.start(); o.stop(ctx.currentTime+0.02);
}
async function startAudio(){
  initAudio();
  if (ctx.state==='suspended') await ctx.resume();
  started = true; hideTapOverlay(); startBtn.textContent='Gotowe'; startBtn.disabled=true;
}
function hideTapOverlay(){ const ov=document.getElementById('tapStart'); if(ov) ov.style.display='none'; }
function showTapOverlay(){ const ov=document.getElementById('tapStart'); if(ov) ov.style.display='flex'; }

function envGain(time,g,a=0.001,d=0.2,sustain=0.0,r=0.2){
  g.gain.cancelScheduledValues(time);
  g.gain.setValueAtTime(0.0001,time);
  g.gain.exponentialRampToValueAtTime(1.0,time+a);
  g.gain.exponentialRampToValueAtTime(Math.max(0.0001,sustain),time+a+d);
  g.gain.exponentialRampToValueAtTime(0.0001,time+a+d+r);
}
function noiseBuffer(){
  const len=Math.floor(ctx.sampleRate*2.0);
  const buffer=ctx.createBuffer(1,len,ctx.sampleRate);
  const data=buffer.getChannelData(0);
  for(let i=0;i<len;i++) data[i]=Math.random()*2-1;
  return buffer;
}
const sharedNoise=(()=>{let _b=null;return()=>_b||(_b=noiseBuffer())})();

function quickTapVisual(el){ el.classList.add('active'); setTimeout(()=>el.classList.remove('active'),120); }

const S = {
  kick(t=ctx.currentTime){ const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine'; o.frequency.setValueAtTime(150,t); o.frequency.exponentialRampToValueAtTime(50,t+.5);
    g.gain.setValueAtTime(1,t); g.gain.exponentialRampToValueAtTime(.0001,t+.5);
    o.connect(g).connect(master); o.start(t); o.stop(t+.6); },
  kick808(t=ctx.currentTime){ const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine'; o.frequency.setValueAtTime(70,t); o.frequency.exponentialRampToValueAtTime(38,t+.6);
    g.gain.setValueAtTime(1,t); g.gain.exponentialRampToValueAtTime(.0001,t+.75);
    const click=ctx.createBufferSource(); click.buffer=sharedNoise(); const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=1200;
    const gc=ctx.createGain(); gc.gain.value=.5; gc.gain.exponentialRampToValueAtTime(.0001,t+.03);
    click.connect(hp).connect(gc).connect(master); click.start(t); click.stop(t+.05);
    o.connect(g).connect(master); o.start(t); o.stop(t+.8); },
  subDrop(t=ctx.currentTime){ const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine'; o.frequency.setValueAtTime(55,t); o.frequency.exponentialRampToValueAtTime(20,t+1.1);
    g.gain.setValueAtTime(1,t); g.gain.exponentialRampToValueAtTime(.0001,t+1.2);
    o.connect(g).connect(master); o.start(t); o.stop(t+1.25); },
  snare(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine'; o.frequency.value=180;
    const gTone=ctx.createGain(); gTone.gain.value=.5; gTone.gain.exponentialRampToValueAtTime(.0001,t+.18);
    o.connect(gTone).connect(master); o.start(t); o.stop(t+.2);
    const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1800; bp.Q.value=.5;
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=700;
    const g=ctx.createGain(); envGain(t,g,.001,.06,.01,.12); nb.connect(bp).connect(hp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.25); },
  clap(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1000; bp.Q.value=.6;
    const g=ctx.createGain(); g.gain.value=.0001;
    g.gain.setValueAtTime(.9,t); g.gain.exponentialRampToValueAtTime(.0001,t+.02);
    g.gain.setValueAtTime(.8,t+.03); g.gain.exponentialRampToValueAtTime(.0001,t+.05);
    g.gain.setValueAtTime(.7,t+.06); g.gain.exponentialRampToValueAtTime(.0001,t+.12);
    nb.connect(bp).connect(g).connect(master); nb.start(t); nb.stop(t+.2); },
  hatClosed(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=6000;
    const g=ctx.createGain(); envGain(t,g,.001,.02,.001,.05); nb.connect(hp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.1); },
  hatOpen(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=6000;
    const g=ctx.createGain(); envGain(t,g,.001,.08,.05,.5); nb.connect(hp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.8); },
  crash(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=4000;
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=10000; bp.Q.value=.5;
    const g=ctx.createGain(); envGain(t,g,.001,.12,.2,1.2); nb.connect(hp).connect(bp).connect(g).connect(master);
    nb.start(t); nb.stop(t+1.5); },
  ride(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=3000;
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=8000; bp.Q.value=.7;
    const g=ctx.createGain(); envGain(t,g,.001,.2,.25,1.6); nb.connect(hp).connect(bp).connect(g).connect(master);
    nb.start(t); nb.stop(t+1.8);
    const o=ctx.createOscillator(); o.type='sine'; o.frequency.value=600;
    const g2=ctx.createGain(); g2.gain.value=.3; g2.gain.exponentialRampToValueAtTime(.0001,t+.12);
    o.connect(g2).connect(master); o.start(t); o.stop(t+.15); },
  shaker(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=5000;
    const g=ctx.createGain(); envGain(t,g,.001,.05,.02,.08); nb.connect(hp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.2); },
  tambourine(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const hp=ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value=4500;
    const g=ctx.createGain(); envGain(t,g,.001,.08,.05,.25); nb.connect(hp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.35); },
  tomHigh(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(330,t); o.frequency.exponentialRampToValueAtTime(180,t+.32);
    const g=ctx.createGain(); envGain(t,g,.001,.12,.01,.22); o.connect(g).connect(master); o.start(t); o.stop(t+.38); },
  tomLow(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(220,t); o.frequency.exponentialRampToValueAtTime(120,t+.35);
    const g=ctx.createGain(); envGain(t,g,.001,.15,.01,.25); o.connect(g).connect(master); o.start(t); o.stop(t+.4); },
  floorTom(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(140,t); o.frequency.exponentialRampToValueAtTime(90,t+.38);
    const g=ctx.createGain(); envGain(t,g,.001,.18,.01,.28); o.connect(g).connect(master); o.start(t); o.stop(t+.45); },
  bongoHigh(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(980,t); o.frequency.exponentialRampToValueAtTime(860,t+.09);
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=6;
    const g=ctx.createGain(); envGain(t,g,.001,.06,.001,.12); o.connect(bp).connect(g).connect(master);
    o.start(t); o.stop(t+.14); },
  bongoLow(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(620,t); o.frequency.exponentialRampToValueAtTime(480,t+.1);
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=700; bp.Q.value=5;
    const g=ctx.createGain(); envGain(t,g,.001,.07,.001,.14); o.connect(bp).connect(g).connect(master);
    o.start(t); o.stop(t+.16); },
  congaOpen(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='sine';
    o.frequency.setValueAtTime(420,t); o.frequency.exponentialRampToValueAtTime(360,t+.22);
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=500; bp.Q.value=5;
    const g=ctx.createGain(); envGain(t,g,.001,.14,.08,.28); o.connect(bp).connect(g).connect(master);
    o.start(t); o.stop(t+.4); },
  congaSlap(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='square'; o.frequency.value=900;
    const g=ctx.createGain(); envGain(t,g,.001,.03,.001,.08); o.connect(g).connect(master); o.start(t); o.stop(t+.1); },
  clave(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='square'; o.frequency.value=2000;
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=2000; bp.Q.value=10;
    const g=ctx.createGain(); envGain(t,g,.001,.02,.001,.06); o.connect(bp).connect(g).connect(master); o.start(t); o.stop(t+.08); },
  woodblock(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='square'; o.frequency.value=1400;
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1400; bp.Q.value=8;
    const g=ctx.createGain(); envGain(t,g,.001,.03,.001,.08); o.connect(bp).connect(g).connect(master); o.start(t); o.stop(t+.1); },
  cowbell(t=ctx.currentTime){ const o1=ctx.createOscillator(); o1.type='square'; o1.frequency.value=540;
    const o2=ctx.createOscillator(); o2.type='square'; o2.frequency.value=800;
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=800; bp.Q.value=5;
    const g=ctx.createGain(); envGain(t,g,.001,.06,.01,.12); o1.connect(bp); o2.connect(bp); bp.connect(g).connect(master);
    o1.start(t); o2.start(t); o1.stop(t+.18); o2.stop(t+.18); },
  rim(t=ctx.currentTime){ const o=ctx.createOscillator(); o.type='square'; o.frequency.value=2200;
    const g=ctx.createGain(); envGain(t,g,.001,.03,.001,.05); o.connect(g).connect(master); o.start(t); o.stop(t+.09); },
  perc(t=ctx.currentTime){ const nb=ctx.createBufferSource(); nb.buffer=sharedNoise();
    const bp=ctx.createBiquadFilter(); bp.type='bandpass'; bp.frequency.value=1200; bp.Q.value=3;
    const g=ctx.createGain(); envGain(t,g,.001,.08,.01,.25); nb.connect(bp).connect(g).connect(master);
    nb.start(t); nb.stop(t+.35); },
};

const ALL = [
  {id:'kick', label:'Kick'},{id:'kick808', label:'808 Kick'},{id:'subDrop', label:'Sub Drop'},
  {id:'snare', label:'Snare'},{id:'clap', label:'Clap'},{id:'hatClosed', label:'Hi-Hat Closed'},
  {id:'hatOpen', label:'Hi-Hat Open'},{id:'crash', label:'Crash'},{id:'ride', label:'Ride'},
  {id:'tomHigh', label:'Tom High'},{id:'tomLow', label:'Tom Low'},{id:'floorTom', label:'Floor Tom'},
  {id:'bongoHigh', label:'Bongo High'},{id:'bongoLow', label:'Bongo Low'},{id:'congaOpen', label:'Conga Open'},
  {id:'congaSlap', label:'Conga Slap'},{id:'clave', label:'Clave'},{id:'woodblock', label:'Woodblock'},
  {id:'shaker', label:'Shaker'},{id:'tambourine', label:'Tambourine'},{id:'rim', label:'Rimshot'},
  {id:'cowbell', label:'Cowbell'},{id:'perc', label:'Perc'},
];
let selected = ['kick808','snare','hatClosed','hatOpen','tomLow','tomHigh','clap','cowbell','crash','ride','rim','subDrop'];

const grid = document.getElementById('grid');
function renderPads(){
  grid.innerHTML='';
  selected.slice(0,12).forEach((id)=>{
    const el=document.createElement('div');
    el.className='pad'; el.dataset.sound=id;
    el.innerHTML = (ALL.find(x=>x.id===id)?.label || id).toUpperCase();
    grid.appendChild(el);
  });
}
function trigger(name){ if(!ctx) initAudio(); S[name]?.(); }

grid.addEventListener('pointerdown',(e)=>{
  const el=e.target.closest('.pad'); if(!el) return; e.preventDefault();
  if(!started) return;
  trigger(el.dataset.sound); quickTapVisual(el);
},{passive:false});
grid.addEventListener('touchstart',(e)=>{
  const el=e.target.closest('.pad'); if(!el) return;
  if(!started) return;
  trigger(el.dataset.sound); quickTapVisual(el);
},{passive:true});

const startBtn=document.getElementById('startBtn');
const tapStartBtn=document.getElementById('tapStartBtn');
['click','touchstart'].forEach(ev=>{
  startBtn.addEventListener(ev,()=>startAudio(),{passive:true});
  tapStartBtn.addEventListener(ev,()=>startAudio(),{passive:true});
});

document.addEventListener('visibilitychange',()=>{
  if(document.visibilityState==='visible' && (!ctx || ctx.state!=='running')) showTapOverlay();
});

const kitBtn=document.getElementById('kitBtn');
const panel=document.getElementById('panel');
const kitList=document.getElementById('kitList');
const applyBtn=document.getElementById('applyBtn');
const closeBtn=document.getElementById('closeBtn');

function renderKitList(){
  kitList.innerHTML='';
  ALL.forEach(inst=>{
    const id='chk_'+inst.id;
    const wrap=document.createElement('label');
    wrap.innerHTML = `<input type="checkbox" id="${id}"> ${inst.label}`;
    kitList.appendChild(wrap);
    const cb=wrap.querySelector('input');
    cb.checked = selected.includes(inst.id);
    cb.addEventListener('change',()=>{
      if(cb.checked){
        if(!selected.includes(inst.id)){
          if(selected.length>=12){ cb.checked=false; return; }
          selected.push(inst.id);
        }
      }else{
        selected = selected.filter(x=>x!==inst.id);
      }
    });
  });
}
function openPanel(){ renderKitList(); panel.style.display='block'; kitBtn.setAttribute('aria-expanded','true'); }
function closePanel(){ panel.style.display='none'; kitBtn.setAttribute('aria-expanded','false'); }
kitBtn.addEventListener('click',()=> panel.style.display==='block' ? closePanel() : openPanel());
closeBtn.addEventListener('click',closePanel);
applyBtn.addEventListener('click',()=>{ renderPads(); closePanel(); });

const keyMap = ['q','w','e','r','a','s','d','f','z','x','c','v'];
document.addEventListener('keydown',(e)=>{
  if(!started) return;
  const k=e.key.toLowerCase();
  const idx=keyMap.indexOf(k);
  if(idx>=0 && idx<selected.length){
    trigger(selected[idx]);
    const pad=grid.children[idx]; if(pad) quickTapVisual(pad);
  }
});

renderPads();
showTapOverlay();
})();
</script>
</body>
</html>
